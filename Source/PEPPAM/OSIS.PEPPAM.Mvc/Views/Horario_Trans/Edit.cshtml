@*
    //------------------------------------------------------------------------------
    // <auto-generated>
    //    This code was generated from a template.
    //
    //    Creador : Administrator
    //    Dominio : OSISPC
    //    Pc      : OSISPC
    //    Fecha   : 5/4/2014 5:51:30 PM
    //
    //    Manual changes to this file may cause unexpected behavior in your application.
    //    Manual changes to this file will be overwritten if the code is regenerated.
    // </auto-generated>
    //------------------------------------------------------------------------------

*@
@using Mvc.Core.UI
@using OSIS.PEPPAM.Mvc.UI
@model OSIS.PEPPAM.Mvc.Models.Horario_TransModel
@{
    IFuncionality uiObject = new Funcionality().GetFuncionality("Horario_Trans");

    ViewBag.Title = Resources.Shared.AppName + " - " + uiObject.Name + " : " + Model.EntityDisplayName;
    string twoLettersCulture = new System.Globalization.CultureInfo(Culture).TwoLetterISOLanguageName;
    string decimalSeparator = new System.Globalization.CultureInfo(Culture).NumberFormat.NumberDecimalSeparator;
    string groupSeparator = new System.Globalization.CultureInfo(Culture).NumberFormat.NumberGroupSeparator;
}

<style>
   .modal-dialog {
       width: 800px;
   }
</style>



<div class="entity-form-container">
    @using (Html.BeginForm("Edit", "Horario_Trans", FormMethod.Post, new { id = "Horario_TransForm", role = "form", @class = "form-horizontal form" }))
    {
        <h2>@uiObject.Name</h2>
        <h5>@uiObject.Description</h5>

        <hr />
        @Html.ValidationSummary(true)


        @Html.Partial("_CreateOrEdit", Model)
        <hr />
        if (Model.Horario_Publicar == "N")
        {
            <div class="alert alert-warning">
                <span>
                    @Html.Raw(Messages.GetOrSetMensaje("MENSAJE_ADVERTENCIA_HORARIO_NO_PUBLICACADO"))
                </span>
            </div>
        }
        <div class="form-commands-container">
            <button class="btn btn-default btn-sm back-button" title="@uiObject.GetAction("Back").Help"><span class="glyphicon glyphicon-arrow-left"></span>@uiObject.GetAction("Back").Description</button>
            <button class="btn  btn-default btn-sm save-button" title="@uiObject.GetAction("Save")"><span class="glyphicon glyphicon-ok"></span>@uiObject.GetAction("Save").Description</button>

            <button class="btn btn-default btn-sm create-button" title="@uiObject.GetAction("AddTurno").Help" data-grid="Horario_Turno_TransGrid" data-masterid="@Model.Horario_Secuencia" data-detailname="AddHorario_Turno_Trans">
                <span class="glyphicon glyphicon-plus"></span>@uiObject.GetAction("AddTurno").Description
            </button>

        </div>
        <div class="row">
            <div class="col-lg-12">
                <div id="horario_Turno_TransTab" class="">


                    <table id="Horario_Turno_TransGrid" width="100%" class="table table-striped table-bordered"></table>


                </div>
            </div>
        </div>




    }
</div>





<div class="modal fade" id="myModal" tabindex="-1" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true">
    <div class="modal-dialog">
        <div class="modal-content">

        </div>
    </div>
</div>
<!-- Horario_Turno_Trans Tab begin -->
<!-- Horario_Turno_Trans Tab end -->
@section Scripts {
    @Scripts.Render("~/bundles/jqueryval")
    <script src="@Url.Content("~/Scripts/App/popupAddOrEdit.js")" type="text/javascript"></script>


    <script type="text/javascript">
        $(function () {
            formUtils.setupFormControls("Horario_TransForm");
            formUtils.setupFormActionButtons({
                formId: "Horario_TransForm",
                indexPageUrl: "@Url.Action("Index")",
                buttonsContainerSelector: ".form-commands-container"
            });

            setupHorario_Turno_TransGrid();

            dialogCustomActions.addEvent({
                gridId: "Horario_Turno_TransGrid",
                messages: '@Html.Raw(Messages.GetOrSetMensaje("MENSAJE_NOTIFICAR_BORRAR_TURNO").Trim())',
                titlewindow: 'Borrar Turno',
                selector: '.row-delete-turno'
            });


            setupCancelarTurno();

        });
        var Horario_Turno_TransGrid;

        function setupHorario_Turno_TransGrid() {
            var gridId = "Horario_Turno_TransGrid";

            if ($("#" + gridId).data("grid-initialized")) {
                Horario_Turno_TransGrid.fnClearTable();
                return;
            } else
                $("#" + gridId).data("grid-initialized", "true");


            @*gridUtils.setupGridToolbarButtons({
                gridId: gridId,
                toolbarContainerSelector: ".form-commands-container",
                addUrl: "@Url.Action("AddHorarioTurnoTrans", "Horario_Trans", new {horario_Secuencia = Model.Horario_Secuencia})",
                reportUrl: "@Url.Action("ReportHorarioTurnoTrans", "Horario_Trans", new {horario_Secuencia = Model.Horario_Secuencia})"
            });*@

            gridUtils.setupGridRowButtons({
                gridId: gridId
            });

            Horario_Turno_TransGrid = $("#" + gridId).dataTable({
                "aoColumns": [
                    @Html.Raw(uiObject.GetGridColumnsArray("Proc_Horarios_Turnos_Dias")),
                    {
                        sClass: "row-options small",
                        bSortable: false,
                        mData: null,
                        mRender: function (data, type, datasource) {
                            var rowId = datasource.Horario_Turno_Secuencia;
                            var editHtml = '<a href="@Url.Action("EditHorarioTurnoTrans", "Horario_Trans")?horario_Turno_Secuencia_child=' + rowId + '&horario_Secuencia_parent=@Model.Horario_Secuencia" data-detailname="EditHorario_Turno_Trans" class="row-edit-turno btn btn-sm btn-default" title="@uiObject.GetAction("Edit").Description"><span class="glyphicon glyphicon-pencil" /> </a>';

                            var deleteHtml = '<a href="@Url.Action("DeleteHorarioTurnoTrans", "Horario_Trans")?horario_Turno_Secuencia_child=' + rowId + '&horario_Secuencia_parent=@Model.Horario_Secuencia" class="row-delete-turno btn btn-sm btn-danger" title="@uiObject.GetAction("Delete").Description"><span class="glyphicon glyphicon-remove" /> </a>';

                            var cancelarTurnoHtml = '<a href="@Url.Action("GetCancelarTurno", "Horario_Trans")?horario_Turno_Secuencia_child=' + rowId + '&horario_Secuencia_parent=@Model.Horario_Secuencia" class="row-cancelar-turno btn btn-sm btn-warning" title="@uiObject.GetAction("Cerrar Turno").Description"><span class="glyphicon glyphicon-off" /> </a>';

                            return editHtml + '|' + deleteHtml + '|' + cancelarTurnoHtml;
                        }
                    }
                ],
                "aaSorting": [[1, "asc"]],
                "columnDefs": [
                    {
                        // The `data` parameter refers to the data for the cell (defined by the
                        // `data` option, which defaults to the column being worked with, in
                        // this case `data: 0`.
                        "render": function (data, type, row) {
                            //console.log(row);


                            var strReturn = '<ul>';
                            var datos = data.split(",");

                            datos.forEach(function (entry) {
                                strReturn += '<li>' + entry + '</li>';
                            });


                            return strReturn + '</ul>';
                        },
                        "targets": 7
                    },
                    {
                        "render": function (data, type, row) {

                            var minutes = (data % 60);
                            if (minutes < 10) {
                                minutes = '0' + minutes;
                            }
                            return Math.floor(data / 60) + ':' + minutes + ' hr(s)';
                        },
                        "targets": 3
                    }
                ],
                "oLanguage": datatables_locale,
                "bFilter": false, /* Disable filtering */
                "bSort": false, /* Disable sorting */
                "bProcessing": true,
                "bServerSide": true,
                "sAjaxSource": "@Url.Action("LoadHorarioTurnoTrans")",
                "sServerMethod": "POST",

                "fnServerParams": function (aoData) {
                    aoData.push({ "name": "horario_Secuencia", "value": "@Model.Horario_Secuencia" });
                }
            });

        }


        $(document).on('click', '.create-button', function (evt) {
            evt.preventDefault();
            $(this).popupAddOrEdit({
                urlGet: '@Url.Action("AddHorarioTurnoTrans", "Horario_Trans", new { horario_Secuencia = Model.Horario_Secuencia })',
                urlPost: '@Url.Action("AddHorarioTurnoTrans", "Horario_Trans")',
                showTitle: false,
                rediretOrReload: "reload"
            });
        });

        $(document).on('click', '.row-edit-turno', function (evt) {
            evt.preventDefault();

            var urlGet = $(this).prop('href');

            $(this).popupAddOrEdit({
                urlGet: urlGet,
                urlPost: '@Url.Action("EditHorarioTurnoTrans", "Horario_Trans")',
                showTitle: false,
                rediretOrReload: "reload"
            });
        });




        function setupCancelarTurno() {

            $(document).on("click", ".row-cancelar-turno", function (evt) {
                evt.preventDefault();
                var url = $(this).prop('href');

                $.ajax({
                    url: url,
                    type: 'GET',
                    success: function (data) {
                        //alert(data);
                        $('.modal-content').html(data);
                        $('#myModal').modal('show');
                    }
                });

            })

            $(document).on("click", ".cerrarmodal", function (evt) {
                evt.preventDefault();
                $('#myModal').modal('hide');
            })


            $(document).on("click", "#btnCancelar", function (evt) {
                evt.preventDefault();

                var url = $('#Horario_TransFormCancelar').prop("action");
                
                console.log($('#Horario_TransFormCancelar').serialize());

                $.ajax({
                    url: url,
                    //type: 'POST',
                    data: $('#Horario_TransFormCancelar').serialize(),
                    success: function (data) {
                        if (data.Result == "Ok") {
                            $('#myModal').modal('hide');
                            //Horario_Turno_TransGrid.fnReloadAjax();
                            setupHorario_Turno_TransGrid();
                        } else {
                            $('.modal-content').html(data.html);
                            //$('#myModal').modal('show');
                        }
                    }
                });


            })


        }


    </script>


    <script type="text/javascript">

    </script>

}


