@*
    //------------------------------------------------------------------------------
    // <auto-generated>
    //    This code was generated from a template.
    //
    //    Creador : f.peguero
    //    Dominio : SSRL
    //    Pc      : DTI_GTE_GIS
    //    Fecha   : 02/05/2014 06:22:59 p.m.
    //
    //    Manual changes to this file may cause unexpected behavior in your application.
    //    Manual changes to this file will be overwritten if the code is regenerated.
    // </auto-generated>
    //------------------------------------------------------------------------------

*@
@using Mvc.Core.UI
@using OSIS.PEPPAM.Mvc.UI
@model OSIS.PEPPAM.Mvc.Models.Circuitos_CataModel
@{
    IFuncionality uiObject = new Funcionality().GetFuncionality("Circuitos_Cata");

    ViewBag.Title = Resources.Shared.AppName + " - " + uiObject.Name + " : " + Model.EntityDisplayName;
    string twoLettersCulture = new System.Globalization.CultureInfo(Culture).TwoLetterISOLanguageName;
    string decimalSeparator = new System.Globalization.CultureInfo(Culture).NumberFormat.NumberDecimalSeparator;
    string groupSeparator = new System.Globalization.CultureInfo(Culture).NumberFormat.NumberGroupSeparator;
}

<div class="entity-form-container">
    @using (Html.BeginForm("Edit", "Circuitos_Cata", FormMethod.Post, new { id = "Circuitos_CataForm", role = "form", @class = "form-horizontal form" }))
    {
        <h2>@uiObject.Name <small>@uiObject.Description</small></h2>

        <div class="form-commands-container">
            <button class="btn btn-default btn-sm back-button" title="@uiObject.GetAction("Back").Help"><span class="glyphicon glyphicon-arrow-left"></span>@uiObject.GetAction("Back").Description</button>
            <button class="btn  btn-default btn-sm save-button" title="@uiObject.GetAction("Save")"><span class="glyphicon glyphicon-ok"></span>@uiObject.GetAction("Save").Description</button>
        </div>

        <hr />

        @Html.ValidationSummary(true)
        @Html.Partial("_CreateOrEdit", Model)
    }
</div>

<div class="form">
    <div id="Circuitos_CataTab-tabs">
        <ul class="nav nav-tabs">

            <li>
                <a href="#congregacionesTab" data-toggle="tab">@Funcionality.GetDescription("Congregaciones_Master", "Congregaciones_Master")</a>
            </li>

        </ul>
    </div>

    <div id="Circuitos_CataTab-contents" class="tab-content">


        <!-- Congregaciones Tab begin -->
        <div id="congregacionesTab" class="tab-pane fade">

            <!-- Grid begin -->
            <div class="secondary-grid-commands">
                <button class="btn btn-default btn-xs popup-create-button" title="@uiObject.GetAction("Create").Help" data-grid="CongregacionesGrid" data-masterid="@Model.Circuito_Numero" data-detailname="AddCongregaciones">
                    <span class="glyphicon glyphicon-plus"></span>@uiObject.GetAction("Create").Description
                </button>
                <button class="btn btn-default btn-xs report-button" title="@uiObject.GetAction("Report").Help">
                    <span class="glyphicon glyphicon-download-alt"></span>@uiObject.GetAction("Report").Description
                </button>
            </div>
            <table id="CongregacionesGrid" width="100%" class="table table-striped table-bordered"></table>
            <!-- Grid end -->

        </div>
        <!-- Congregaciones Tab end -->

    </div>

</div>


@section Scripts {
    @Scripts.Render("~/bundles/jqueryval")
    <script type="text/javascript">
        $(function () {
            formUtils.setupFormControls("Circuitos_CataForm");
            formUtils.setupFormActionButtons({
                formId: "Circuitos_CataForm",
                indexPageUrl: "@Url.Action("Index")",
                buttonsContainerSelector: ".form-commands-container"
            });

            $('#Circuitos_CataTab-tabs a[data-toggle="tab"]').on('shown.bs.tab', function (e, s) {
                var tabShown = e.target.attributes["href"].value;
                if (tabShown == "#congregacionesTab") {
                    setupCongregacionesGrid();
                }
            });
            $("#Circuitos_CataTab-tabs a[data-toggle='tab']:first").tab("show");
        });
        var CongregacionesGrid;
        function setupCongregacionesGrid() {
            var gridId = "CongregacionesGrid";

            if ($("#" + gridId).data("grid-initialized")) {
                CongregacionesGrid.fnClearTable();
                return;
            }
            else
                $("#" + gridId).data("grid-initialized", "true");


            gridUtils.setupGridToolbarButtons({
                gridId: gridId,
                toolbarContainerSelector: "#congregacionesTab",
                addUrl: "@Url.Action("AddCongregaciones", "Circuitos_Cata", new {circuito_Numero = Model.Circuito_Numero})",
                reportUrl: "@Url.Action("ReportCongregaciones", "Circuitos_Cata", new {circuito_Numero = Model.Circuito_Numero})"
            });

            gridUtils.setupGridRowButtons({
                gridId: gridId
            });

            CongregacionesGrid = $("#" + gridId).dataTable({
                "aoColumns": [
                @Html.Raw(uiObject.GetGridColumnsArray("Congregaciones_Master")),

                    {
                        sClass: "row-options small",
                        bSortable: false,
                        mData: null,
                        mRender: function (data, type, datasource) {
                            var rowId = datasource.Congregacion_Secuencia;
                            var editHtml = '<a href="@Url.Action("EditCongregaciones", "Circuitos_Cata")?congregacion_Secuencia_child=' + rowId + '&circuito_Numero_parent=@Model.Circuito_Numero" data-detailname="EditCongregaciones" class="row-popup-edit btn btn-sm btn-default" title="@Resources.Shared.Edit"><span class="glyphicon glyphicon-pencil" /></a>';
                            var deleteHtml = '<a href="@Url.Action("DeleteCongregaciones", "Circuitos_Cata")?congregacion_Secuencia_child=' + rowId + '&circuito_Numero_parent=@Model.Circuito_Numero" class="row-delete btn btn-sm btn-danger" title="@Resources.Shared.Delete"><span class="glyphicon glyphicon-remove" /></a>';
                            return editHtml + deleteHtml;
                        }
                    }
                ],
                "aaSorting": [[1, "asc"]],

                "oLanguage": datatables_locale,
                "bFilter": false, /* Disable filtering */
                "bSort": false, /* Disable sorting */
                "bProcessing": true,
                "bServerSide": true,
                "sAjaxSource": "@Url.Action("LoadCongregaciones")",
                "sServerMethod": "POST",

                "fnServerParams": function (aoData) {
                    aoData.push({ "name": "circuito_Numero", "value": "@Model.Circuito_Numero" });
                }
            });
        }

    </script>
}


