@*
    //------------------------------------------------------------------------------
    // <auto-generated>
    //    This code was generated from a template.
    //
    //    Creador : f.peguero
    //    Dominio : SSRL
    //    Pc      : DTI_GTE_GIS
    //    Fecha   : 02/05/2014 06:23:42 p.m.
    //
    //    Manual changes to this file may cause unexpected behavior in your application.
    //    Manual changes to this file will be overwritten if the code is regenerated.
    // </auto-generated>
    //------------------------------------------------------------------------------

*@
@using Mvc.Core.UI
@using OSIS.PEPPAM.Mvc.UI
@model OSIS.PEPPAM.Mvc.Models.Zonas_MasterModel
@{
    IFuncionality uiObject = new Funcionality().GetFuncionality("Zonas_Master");

    ViewBag.Title = Resources.Shared.AppName + " - " + uiObject.Name + " : " + Model.EntityDisplayName;
    string twoLettersCulture = new System.Globalization.CultureInfo(Culture).TwoLetterISOLanguageName;
    string decimalSeparator = new System.Globalization.CultureInfo(Culture).NumberFormat.NumberDecimalSeparator;
    string groupSeparator = new System.Globalization.CultureInfo(Culture).NumberFormat.NumberGroupSeparator;
}
<h2>@uiObject.Name</h2>
<h5>@uiObject.Description</h5>
<div class="form-commands-container">
    <button class="btn btn-default btn-sm back-button" title="@uiObject.GetAction("Back").Help"><span class="glyphicon glyphicon-arrow-left"></span>@uiObject.GetAction("Back").Description</button>
    <button class="btn  btn-default btn-sm save-button" title="@uiObject.GetAction("Save")"><span class="glyphicon glyphicon-ok"></span>@uiObject.GetAction("Save").Description</button>
</div>

<div class="entity-form-container">
    @using (Html.BeginForm("Edit", "Zonas_Master", FormMethod.Post, new { id = "Zonas_MasterForm", role = "form", @class = "form-horizontal" }))
    {
        @Html.ValidationSummary(true)
        @Html.Partial("_CreateOrEdit", Model)
    }
</div>

<div id="Zonas_MasterTab-tabs">
    <ul class="nav nav-tabs">

        <li>
            <a href="#encargadosTab" data-toggle="tab">@Funcionality.GetDescription("Zonas_Encargados_Trans", "Zonas_Encargados_Trans")</a>
        </li>

        <li>
            <a href="#rutasTab" data-toggle="tab">@Funcionality.GetDescription("Rutas_Master", "Rutas_Master")</a>
        </li>

    </ul>
</div>

<div id="Zonas_MasterTab-contents" class="tab-content">


    <!-- Encargados Tab begin -->
    <div id="encargadosTab" class="tab-pane fade">

        <!-- Grid begin -->
        <div class="secondary-grid-commands">
            <button class="btn btn-default btn-xs popup-create-button" title="@uiObject.GetAction("Create").Help" data-grid="EncargadosGrid" data-masterid="@Model.Zona_Secuencia" data-detailname="AddEncargados">
                <span class="glyphicon glyphicon-plus"></span>@uiObject.GetAction("Create").Description
            </button>
            <button class="btn btn-default btn-xs report-button" title="@uiObject.GetAction("Report").Help">
                <span class="glyphicon glyphicon-download-alt"></span>@uiObject.GetAction("Report").Description
            </button>
        </div>
        <table id="EncargadosGrid" width="100%" class="table table-striped table-bordered"></table>
        <!-- Grid end -->

    </div>
    <!-- Encargados Tab end -->
    <!-- Rutas Tab begin -->
    <div id="rutasTab" class="tab-pane fade">

        <!-- Grid begin -->
        <div class="secondary-grid-commands">
            <button class="btn btn-default btn-xs popup-create-button" title="@uiObject.GetAction("Create").Help" data-grid="RutasGrid" data-masterid="@Model.Zona_Secuencia" data-detailname="AddRutas">
                <span class="glyphicon glyphicon-plus"></span>@uiObject.GetAction("Create").Description
            </button>
            <button class="btn btn-default btn-xs report-button" title="@uiObject.GetAction("Report").Help">
                <span class="glyphicon glyphicon-download-alt"></span>@uiObject.GetAction("Report").Description
            </button>
        </div>
        <table id="RutasGrid" width="100%" class="table table-striped table-bordered"></table>
        <!-- Grid end -->

    </div>
    <!-- Rutas Tab end -->

</div>




@section Scripts {
    @Scripts.Render("~/bundles/jqueryval")
    <script type="text/javascript">
        $(function () {
            formUtils.setupFormControls("Zonas_MasterForm");
            formUtils.setupFormActionButtons({
                formId: "Zonas_MasterForm",
                indexPageUrl: "@Url.Action("Index")",
                buttonsContainerSelector: ".form-commands-container"
            });

            $('#Zonas_MasterTab-tabs a[data-toggle="tab"]').on('shown.bs.tab', function (e, s) {
                var tabShown = e.target.attributes["href"].value;
                if (tabShown == "#encargadosTab") {
                    setupEncargadosGrid();
                }
                if (tabShown == "#rutasTab") {
                    setupRutasGrid();
                }
            });
            $("#Zonas_MasterTab-tabs a[data-toggle='tab']:first").tab("show");
        });
        var EncargadosGrid;
        function setupEncargadosGrid() {
            var gridId = "EncargadosGrid";

            if ($("#" + gridId).data("grid-initialized")) {
                EncargadosGrid.fnClearTable();
                return;
            }
            else
                $("#" + gridId).data("grid-initialized", "true");


            gridUtils.setupGridToolbarButtons({
                gridId: gridId,
                toolbarContainerSelector: "#encargadosTab",
                addUrl: "@Url.Action("AddEncargados", "Zonas_Master", new {zona_Secuencia = Model.Zona_Secuencia})",
                reportUrl: "@Url.Action("ReportEncargados", "Zonas_Master", new {zona_Secuencia = Model.Zona_Secuencia})"
            });

            gridUtils.setupGridRowButtons({
                gridId: gridId
            });

            EncargadosGrid = $("#" + gridId).dataTable({
                "aoColumns": [
                @Html.Raw(uiObject.GetGridColumnsArray("Zonas_Encargados_Trans")),

                    {
                        sClass: "row-options small",
                        bSortable: false,
                        mData: null,
                        mRender: function (data, type, datasource) {
                            var rowId = datasource.EntityKey;
                            var editHtml = '<a href="@Url.Action("EditEncargados", "Zonas_Master")?entityKey_child=' + rowId + '&zona_Secuencia_parent=@Model.Zona_Secuencia" data-detailname="EditEncargados" class="row-popup-edit btn btn-sm btn-default" title="@Resources.Shared.Edit"><span class="glyphicon glyphicon-pencil" /></a>';
                            var deleteHtml = '<a href="@Url.Action("DeleteEncargados", "Zonas_Master")?entityKey_child=' + rowId + '&zona_Secuencia_parent=@Model.Zona_Secuencia" class="row-delete btn btn-sm btn-danger" title="@Resources.Shared.Delete"><span class="glyphicon glyphicon-remove" /></a>';
                            return editHtml + deleteHtml;
                        }
                    }
                ],
                "aaSorting": [[1, "asc"]],
                
                "oLanguage": datatables_locale,
                "bFilter": false, /* Disable filtering */
                "bSort": false, /* Disable sorting */
                "bProcessing": true,
                "bServerSide": true,
                "sAjaxSource": "@Url.Action("LoadEncargados")",
                "sServerMethod": "POST",
                
                "fnServerParams": function (aoData) {
                    aoData.push({ "name": "zona_Secuencia", "value": "@Model.Zona_Secuencia" });
                }
            });
        }

        var RutasGrid;
        function setupRutasGrid() {
            var gridId = "RutasGrid";

            if ($("#" + gridId).data("grid-initialized")) {
                RutasGrid.fnClearTable();
                return;
            }
            else
                $("#" + gridId).data("grid-initialized", "true");


            gridUtils.setupGridToolbarButtons({
                gridId: gridId,
                toolbarContainerSelector: "#rutasTab",
                addUrl: "@Url.Action("AddRutas", "Zonas_Master", new {zona_Secuencia = Model.Zona_Secuencia})",
                reportUrl: "@Url.Action("ReportRutas", "Zonas_Master", new {zona_Secuencia = Model.Zona_Secuencia})"
            });

            gridUtils.setupGridRowButtons({
                gridId: gridId
            });

            RutasGrid = $("#" + gridId).dataTable({
                "aoColumns": [
                @Html.Raw(uiObject.GetGridColumnsArray("Rutas_Master")),

                    {
                        sClass: "row-options small",
                        bSortable: false,
                        mData: null,
                        mRender: function (data, type, datasource) {
                            var rowId = datasource.Ruta_Secuencia;
                            var editHtml = '<a href="@Url.Action("EditRutas", "Zonas_Master")?ruta_Secuencia_child=' + rowId + '&zona_Secuencia_parent=@Model.Zona_Secuencia" data-detailname="EditRutas" class="row-popup-edit btn btn-sm btn-default" title="@Resources.Shared.Edit"><span class="glyphicon glyphicon-pencil" /></a>';
                            var deleteHtml = '<a href="@Url.Action("DeleteRutas", "Zonas_Master")?ruta_Secuencia_child=' + rowId + '&zona_Secuencia_parent=@Model.Zona_Secuencia" class="row-delete btn btn-sm btn-danger" title="@Resources.Shared.Delete"><span class="glyphicon glyphicon-remove" /></a>';
                            return editHtml + deleteHtml;
                        }
                    }
                ],
                "aaSorting": [[1, "asc"]],
                
                "oLanguage": datatables_locale,
                "bFilter": false, /* Disable filtering */
                "bSort": false, /* Disable sorting */
                "bProcessing": true,
                "bServerSide": true,
                "sAjaxSource": "@Url.Action("LoadRutas")",
                "sServerMethod": "POST",
                
                "fnServerParams": function (aoData) {
                    aoData.push({ "name": "zona_Secuencia", "value": "@Model.Zona_Secuencia" });
                }
            });
        }

    </script>
}


