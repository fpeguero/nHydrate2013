//------------------------------------------------------------------------------
// <auto-generated>
//    This code was generated from a template.
//
//    Creador : Administrator
//    Dominio : OSISPC
//    Pc      : OSISPC
//    Fecha   : 6/19/2014 1:29:11 PM
//
//    Manual changes to this file may cause unexpected behavior in your application.
//    Manual changes to this file will be overwritten if the code is regenerated.
// </auto-generated>
//------------------------------------------------------------------------------


using System; 
using System.Collections.Generic; 
using System.Linq; 
using System.Web.Mvc; 
using System.Web; 
using System.Web.UI; 
using CodeFluent.Runtime; 
using OSIS.PEPPAM.Mvc.Models; 
using OSIS.PEPPAM.Mvc.Extensions.Controllers; 
using OSIS.PEPPAM.Mvc.Models.Shared; 
using OSIS.PEPPAM.Mvc.Extensions.ActionResults; 
using OSIS.PEPPAM.Mvc.Extensions.Controllers; 
using OSIS.PEPPAM.Mvc.Extensions.Helpers; 
using OSIS.PEPPAM.Mvc.Models.Shared; 
using OSIS.PEPPAM.Mvc.Models; 
using OSIS.PEPPAM.Mvc.UI; 
 
namespace OSIS.PEPPAM.Mvc.Controllers 
{ 
    public partial class Dias_CataController : Dias_CataControllerBase 
    { 

    } 
 
	public partial class Dias_CataControllerBase : BaseController 
	{ 
		#region Members 
 

 
        #endregion 
 
        #region Constructors 
 

 
        #endregion 
 
		#region Index 
 

public virtual ActionResult Index()
{
    var model = new Dias_CataModel();

    ViewBag.PageIndex = this.GetPageIndex();
    ViewBag.PageSize = this.GetPageSize();
    ViewBag.SearchValue = this.GetSearchValue();

    return View(model);
}


[HttpPost]
public virtual ActionResult Load(GridRequestViewModel gridRequest)
{
    OrderByArgumentCollection orderByArguments = new OrderByArgumentCollection();
    orderByArguments.Add("[" + gridRequest.SortColumnName + "]", gridRequest.SortDirection);

    PageOptions pageOptions = new PageOptions();
    pageOptions.OrderByArguments = orderByArguments;

    var totalCount = 0;

    var alldiasCata = Dias_CataModel.PageLoadAllPaging(1 + gridRequest.RowStartIndex/gridRequest.RowCount,
        gridRequest.RowCount, gridRequest.Search, pageOptions, out totalCount);

    var displayRecords = alldiasCata.Count;
    var totalRecords = totalCount;

    var dateFormat = System.Globalization.CultureInfo.CurrentCulture.TwoLetterISOLanguageName == "en"
        ? "MM/dd/yyyy"
        : "dd/MM/yyyy";
    System.Globalization.DateTimeFormatInfo dtfi =
        System.Globalization.CultureInfo.CurrentCulture.DateTimeFormat;
    dtfi.DateSeparator = "/";

    return Json(new
    {
        iTotalDisplayRecords = displayRecords,
        iTotalRecords = totalRecords,
        sEcho = gridRequest.GridCustomData,
        aaData =
            alldiasCata.Select(
                d =>
                    new
                    {
d.Dia_Secuencia,d.Dia_Descripcion,d.Dia_Orden,d.Registro_Estado,Registro_Fecha = d.Registro_Fecha.ToString(dateFormat, dtfi),d.Registro_Usuario
                    })
    });

}

public virtual ActionResult Report()
{
    var totalCount = 0;
    var alldiasCata = Dias_CataModel.LoadAllPaging(this.GetSearchValue(), out totalCount);

    var dateFormat = System.Globalization.CultureInfo.CurrentCulture.TwoLetterISOLanguageName == "en"
        ? "MM/dd/yyyy"
        : "dd/MM/yyyy";
    System.Globalization.DateTimeFormatInfo dtfi =
        System.Globalization.CultureInfo.CurrentCulture.DateTimeFormat;
    dtfi.DateSeparator = "/";
    return new CsvReportResult("Dias_Cata",
        alldiasCata.Select(
            d =>
                new
                {
d.Dia_Secuencia,d.Dia_Descripcion,d.Dia_Orden,d.Registro_Estado,Registro_Fecha = d.Registro_Fecha.ToString(dateFormat, dtfi),d.Registro_Usuario
                }));
}


[HttpPost]
public virtual ActionResult Delete( string entityKey)

{
    try
    {
        var deleteModel  = Dias_CataModel.LoadByEntityKey(entityKey);
       if (deleteModel.Delete())
       {
          return Json(new { cssMainClass = "success", title = Messages.GetOrSetMensaje("MENSAJE_OPERACION_REALIZDA_SASTIFACTORIAMENTE_HEADER"), body = Messages.GetOrSetMensaje("MENSAJE_NOTIFICACION_REGISTRO_BORRADO") }, JsonRequestBehavior.AllowGet);
       }
       else
       {
          return Json(new { cssMainClass = "warning", title = Messages.GetOrSetMensaje("MENSAJE_PRECAUSION_HEADER"), body = Messages.GetOrSetMensaje("MENSAJE_NOTIFICACION_REGISTRO_NO_BORRADO") }, JsonRequestBehavior.AllowGet);
       }
    }
    catch (Exception ex)
    {
          return Json(new { cssMainClass = "success", title = Messages.GetOrSetMensaje("MENSAJE_PRECAUSION_HEADER"), body = Messages.GetOrSetMensaje("MENSAJE_NOTIFICACION_REGISTRO_BORRADO") }, JsonRequestBehavior.AllowGet);
    }
    return Content(string.Empty);
}
		 
 
		#endregion 
 
		#region Create 
 

		// ******************************************* 
        // URL: /Dias_Cata/Create 
        // ******************************************* 

public virtual ActionResult Create()
{
    var diasCata = new Dias_CataModel();
    ViewBag.IsNew = true;
    diasCata.Registro_Estado = "A";

    return View(diasCata);
}

//
// POST: /Usuarios/Create
[HttpPost]
public virtual ActionResult Create(Dias_CataModel diasCata)
{
    if (ModelState.IsValid)
    {

        //Campos Auditorias
        diasCata.Registro_Fecha = DateTime.Now;
        diasCata.Registro_Usuario = User.Identity.Name;
                
        var result = diasCata.Save();

        if (result)
        {
            return RedirectToAction("Edit", new { 
dia_Secuencia = diasCata.Dia_Secuencia});
        }

    }

    ViewBag.IsNew = true;
    return View(diasCata);
            
}

		 
 
		#endregion 
 
		#region Edit 
 

		// ******************************************* 
        // URL: /Dias_Cata/Edit/id 
        // ******************************************* 

public virtual ActionResult Edit(int dia_Secuencia)
{

    var diasCata = Dias_CataModel.LoadByEntityKey(dia_Secuencia.ToString());

    ViewBag.IsNew = false;
            
    return View(diasCata);
}

[HttpPost]
public virtual ActionResult Edit(Dias_CataModel diasCata)
{
           
        if (ModelState.IsValid)
        {
        //Campos Auditorias
        diasCata.Registro_Fecha = DateTime.Now;
        diasCata.Registro_Usuario = User.Identity.Name;
                

            var result = diasCata.Save();

            if (result)
            {
                return RedirectToAction("Index");
            }
        }

        ViewBag.IsNew = false;
        return View(diasCata);
}

public virtual ActionResult LoadPersonasDiponibilidad(GridRequestViewModel gridRequest,int dia_Secuencia){
    var personas_Diponibilidad = Dias_CataModel.LoadByEntityKey(dia_Secuencia.ToString());

    int count = personas_Diponibilidad.PersonasDiponibilidad.Count;

    var dateFormat = System.Globalization.CultureInfo.CurrentCulture.TwoLetterISOLanguageName == "en" ? "MM/dd/yyyy" : "dd/MM/yyyy";
    System.Globalization.DateTimeFormatInfo dtfi = System.Globalization.CultureInfo.CurrentCulture.DateTimeFormat;
    dtfi.DateSeparator = "/";

    return Json(new
    {
        iTotalDisplayRecords = count,
        iTotalRecords = count,
        sEcho = gridRequest.GridCustomData,
        aaData = personas_Diponibilidad.PersonasDiponibilidad.Skip(gridRequest.RowStartIndex)
                        .Take(gridRequest.RowCount)
                        .Select(d => new { 
d.EntityKey,d.Registro_Estado,Registro_Fecha = d.Registro_Fecha.ToString(dateFormat, dtfi),d.Registro_Usuario,Persona_Secuencia = d.PersonasMaster != null ? d.PersonasMaster.EntityDisplayName : string.Empty,Hora_Secuencia = d.HorasCata != null ? d.HorasCata.EntityDisplayName : string.Empty,Dia_Secuencia = d.DiasCata != null ? d.DiasCata.EntityDisplayName : string.Empty
    })
 });

}

public virtual ActionResult AddPersonasDiponibilidad(int dia_Secuencia){
    var dias_Cata = Dias_CataModel.LoadByEntityKey(dia_Secuencia.ToString());

    var personas_Diponibilidad = new Personas_DiponibilidadModel();

 personas_Diponibilidad.Dia_Secuencia =dias_Cata.Dia_Secuencia;            

    ViewBag.MasterProperty = "Dias_Cata_Personas_Diponibilidad";

    //relations

    ViewBag.Name = "AddPersonas_Diponibilidad";
    ViewBag.IsNew = true;
    personas_Diponibilidad.Registro_Estado = "A";

    return PartialView("~/Views/Personas_Diponibilidad/PopUp.cshtml", personas_Diponibilidad);
}

[HttpPost]
public virtual ActionResult AddPersonasDiponibilidad(Personas_DiponibilidadModel personas_Diponibilidad)
{
    if (ModelState.IsValid)
    {

        //Campos Auditorias
        personas_Diponibilidad.Registro_Fecha = DateTime.Now;
        personas_Diponibilidad.Registro_Usuario = User.Identity.Name;

        personas_Diponibilidad.Save();
                
        return new HttpStatusCodeResult(200);
    }
    return new HttpStatusCodeResult(500);
}

//Columna por las cuales estan relacionadas
public virtual ActionResult EditPersonasDiponibilidad(int dia_Secuencia_parent, string entityKey_child )
{
    var personas_Diponibilidad =  Personas_DiponibilidadModel.LoadByEntityKey(entityKey_child.ToString());
            
    ViewBag.MasterProperty = "Dias_Cata_Personas_Diponibilidad";
    ViewBag.Name = "EditPersonas_Diponibilidad";
    ViewBag.IsNew = false;

    return PartialView("~/Views/Personas_Diponibilidad/PopUp.cshtml", personas_Diponibilidad);
}

[HttpPost]
public virtual ActionResult EditPersonasDiponibilidad(Personas_DiponibilidadModel personas_Diponibilidad)
{
    if (ModelState.IsValid)
    {
        //Campos Auditorias
        personas_Diponibilidad.Registro_Fecha = DateTime.Now;
        personas_Diponibilidad.Registro_Usuario = User.Identity.Name;
        personas_Diponibilidad.Save();

        return new HttpStatusCodeResult(200);
    }
    return new HttpStatusCodeResult(500);
}

[HttpPost]
public virtual ActionResult DeletePersonasDiponibilidad(int dia_Secuencia_parent, string entityKey_child ){
    var personas_Diponibilidad = Personas_DiponibilidadModel.LoadByEntityKey(entityKey_child.ToString());
       if (personas_Diponibilidad.Delete())
       {
          return Json(new { cssMainClass = "success", title = Messages.GetOrSetMensaje("MENSAJE_OPERACION_REALIZDA_SASTIFACTORIAMENTE_HEADER"), body = Messages.GetOrSetMensaje("MENSAJE_NOTIFICACION_REGISTRO_BORRADO") }, JsonRequestBehavior.AllowGet);
       }
       else
       {
          return Json(new { cssMainClass = "warning", title = Messages.GetOrSetMensaje("MENSAJE_PRECAUSION_HEADER"), body = Messages.GetOrSetMensaje("MENSAJE_NOTIFICACION_REGISTRO_NO_BORRADO") }, JsonRequestBehavior.AllowGet);
       }

}

public virtual ActionResult ReportPersonasDiponibilidad(int dia_Secuencia){
    var personas_Diponibilidad = Dias_CataModel.LoadByEntityKey(dia_Secuencia.ToString());            
    return new CsvReportResult("Personas_Diponibilidad", personas_Diponibilidad.PersonasDiponibilidad);
}

public virtual ActionResult LoadTurnosDiasTrans(GridRequestViewModel gridRequest,int dia_Secuencia){
    var turnos_Dias_Trans = Dias_CataModel.LoadByEntityKey(dia_Secuencia.ToString());

    int count = turnos_Dias_Trans.TurnosDiasTrans.Count;

    var dateFormat = System.Globalization.CultureInfo.CurrentCulture.TwoLetterISOLanguageName == "en" ? "MM/dd/yyyy" : "dd/MM/yyyy";
    System.Globalization.DateTimeFormatInfo dtfi = System.Globalization.CultureInfo.CurrentCulture.DateTimeFormat;
    dtfi.DateSeparator = "/";

    return Json(new
    {
        iTotalDisplayRecords = count,
        iTotalRecords = count,
        sEcho = gridRequest.GridCustomData,
        aaData = turnos_Dias_Trans.TurnosDiasTrans.Skip(gridRequest.RowStartIndex)
                        .Take(gridRequest.RowCount)
                        .Select(d => new { 
d.EntityKey,d.Registro_Estado,Registro_Fecha = d.Registro_Fecha.ToString(dateFormat, dtfi),d.Registro_Usuario,Turno_Numero = d.TurnosMaster != null ? d.TurnosMaster.EntityDisplayName : string.Empty,Dia_Secuencia = d.DiasCata != null ? d.DiasCata.EntityDisplayName : string.Empty
    })
 });

}

public virtual ActionResult AddTurnosDiasTrans(int dia_Secuencia){
    var dias_Cata = Dias_CataModel.LoadByEntityKey(dia_Secuencia.ToString());

    var turnos_Dias_Trans = new Turnos_Dias_TransModel();

 turnos_Dias_Trans.Dia_Secuencia =dias_Cata.Dia_Secuencia;            

    ViewBag.MasterProperty = "Dias_Cata_Turnos_Dias_Trans";

    //relations

    ViewBag.Name = "AddTurnos_Dias_Trans";
    ViewBag.IsNew = true;
    turnos_Dias_Trans.Registro_Estado = "A";

    return PartialView("~/Views/Turnos_Dias_Trans/PopUp.cshtml", turnos_Dias_Trans);
}

[HttpPost]
public virtual ActionResult AddTurnosDiasTrans(Turnos_Dias_TransModel turnos_Dias_Trans)
{
    if (ModelState.IsValid)
    {

        //Campos Auditorias
        turnos_Dias_Trans.Registro_Fecha = DateTime.Now;
        turnos_Dias_Trans.Registro_Usuario = User.Identity.Name;

        turnos_Dias_Trans.Save();
                
        return new HttpStatusCodeResult(200);
    }
    return new HttpStatusCodeResult(500);
}

//Columna por las cuales estan relacionadas
public virtual ActionResult EditTurnosDiasTrans(int dia_Secuencia_parent, string entityKey_child )
{
    var turnos_Dias_Trans =  Turnos_Dias_TransModel.LoadByEntityKey(entityKey_child.ToString());
            
    ViewBag.MasterProperty = "Dias_Cata_Turnos_Dias_Trans";
    ViewBag.Name = "EditTurnos_Dias_Trans";
    ViewBag.IsNew = false;

    return PartialView("~/Views/Turnos_Dias_Trans/PopUp.cshtml", turnos_Dias_Trans);
}

[HttpPost]
public virtual ActionResult EditTurnosDiasTrans(Turnos_Dias_TransModel turnos_Dias_Trans)
{
    if (ModelState.IsValid)
    {
        //Campos Auditorias
        turnos_Dias_Trans.Registro_Fecha = DateTime.Now;
        turnos_Dias_Trans.Registro_Usuario = User.Identity.Name;
        turnos_Dias_Trans.Save();

        return new HttpStatusCodeResult(200);
    }
    return new HttpStatusCodeResult(500);
}

[HttpPost]
public virtual ActionResult DeleteTurnosDiasTrans(int dia_Secuencia_parent, string entityKey_child ){
    var turnos_Dias_Trans = Turnos_Dias_TransModel.LoadByEntityKey(entityKey_child.ToString());
       if (turnos_Dias_Trans.Delete())
       {
          return Json(new { cssMainClass = "success", title = Messages.GetOrSetMensaje("MENSAJE_OPERACION_REALIZDA_SASTIFACTORIAMENTE_HEADER"), body = Messages.GetOrSetMensaje("MENSAJE_NOTIFICACION_REGISTRO_BORRADO") }, JsonRequestBehavior.AllowGet);
       }
       else
       {
          return Json(new { cssMainClass = "warning", title = Messages.GetOrSetMensaje("MENSAJE_PRECAUSION_HEADER"), body = Messages.GetOrSetMensaje("MENSAJE_NOTIFICACION_REGISTRO_NO_BORRADO") }, JsonRequestBehavior.AllowGet);
       }

}

public virtual ActionResult ReportTurnosDiasTrans(int dia_Secuencia){
    var turnos_Dias_Trans = Dias_CataModel.LoadByEntityKey(dia_Secuencia.ToString());            
    return new CsvReportResult("Turnos_Dias_Trans", turnos_Dias_Trans.TurnosDiasTrans);
}

public virtual ActionResult LoadHorarioTurnoDiasTrans(GridRequestViewModel gridRequest,int dia_Secuencia){
    var horario_Turno_Dias_Trans = Dias_CataModel.LoadByEntityKey(dia_Secuencia.ToString());

    int count = horario_Turno_Dias_Trans.HorarioTurnoDiasTrans.Count;

    var dateFormat = System.Globalization.CultureInfo.CurrentCulture.TwoLetterISOLanguageName == "en" ? "MM/dd/yyyy" : "dd/MM/yyyy";
    System.Globalization.DateTimeFormatInfo dtfi = System.Globalization.CultureInfo.CurrentCulture.DateTimeFormat;
    dtfi.DateSeparator = "/";

    return Json(new
    {
        iTotalDisplayRecords = count,
        iTotalRecords = count,
        sEcho = gridRequest.GridCustomData,
        aaData = horario_Turno_Dias_Trans.HorarioTurnoDiasTrans.Skip(gridRequest.RowStartIndex)
                        .Take(gridRequest.RowCount)
                        .Select(d => new { 
d.EntityKey,Turno_Fecha = d.Turno_Fecha.ToString(dateFormat, dtfi),d.Turno_Estado,d.Turno_Razon_Inactivo,d.Turno_Estudios_Iniciado_Cantidad,d.Registro_Estado,Registro_Fecha = d.Registro_Fecha.ToString(dateFormat, dtfi),d.Registro_Usuario,Horario_Turno_Secuencia = d.HorarioTurnoTrans != null ? d.HorarioTurnoTrans.EntityDisplayName : string.Empty,Dia_Secuencia = d.DiasCata != null ? d.DiasCata.EntityDisplayName : string.Empty
    })
 });

}

public virtual ActionResult AddHorarioTurnoDiasTrans(int dia_Secuencia){
    var dias_Cata = Dias_CataModel.LoadByEntityKey(dia_Secuencia.ToString());

    var horario_Turno_Dias_Trans = new Horario_Turno_Dias_TransModel();

 horario_Turno_Dias_Trans.Dia_Secuencia =dias_Cata.Dia_Secuencia;            

    ViewBag.MasterProperty = "Dias_Cata_Horario_Turno_Dias_Trans";

    //relations

    ViewBag.Name = "AddHorario_Turno_Dias_Trans";
    ViewBag.IsNew = true;
    horario_Turno_Dias_Trans.Registro_Estado = "A";

    return PartialView("~/Views/Horario_Turno_Dias_Trans/PopUp.cshtml", horario_Turno_Dias_Trans);
}

[HttpPost]
public virtual ActionResult AddHorarioTurnoDiasTrans(Horario_Turno_Dias_TransModel horario_Turno_Dias_Trans)
{
    if (ModelState.IsValid)
    {

        //Campos Auditorias
        horario_Turno_Dias_Trans.Registro_Fecha = DateTime.Now;
        horario_Turno_Dias_Trans.Registro_Usuario = User.Identity.Name;

        horario_Turno_Dias_Trans.Save();
                
        return new HttpStatusCodeResult(200);
    }
    return new HttpStatusCodeResult(500);
}

//Columna por las cuales estan relacionadas
public virtual ActionResult EditHorarioTurnoDiasTrans(int dia_Secuencia_parent, string entityKey_child )
{
    var horario_Turno_Dias_Trans =  Horario_Turno_Dias_TransModel.LoadByEntityKey(entityKey_child.ToString());
            
    ViewBag.MasterProperty = "Dias_Cata_Horario_Turno_Dias_Trans";
    ViewBag.Name = "EditHorario_Turno_Dias_Trans";
    ViewBag.IsNew = false;

    return PartialView("~/Views/Horario_Turno_Dias_Trans/PopUp.cshtml", horario_Turno_Dias_Trans);
}

[HttpPost]
public virtual ActionResult EditHorarioTurnoDiasTrans(Horario_Turno_Dias_TransModel horario_Turno_Dias_Trans)
{
    if (ModelState.IsValid)
    {
        //Campos Auditorias
        horario_Turno_Dias_Trans.Registro_Fecha = DateTime.Now;
        horario_Turno_Dias_Trans.Registro_Usuario = User.Identity.Name;
        horario_Turno_Dias_Trans.Save();

        return new HttpStatusCodeResult(200);
    }
    return new HttpStatusCodeResult(500);
}

[HttpPost]
public virtual ActionResult DeleteHorarioTurnoDiasTrans(int dia_Secuencia_parent, string entityKey_child ){
    var horario_Turno_Dias_Trans = Horario_Turno_Dias_TransModel.LoadByEntityKey(entityKey_child.ToString());
       if (horario_Turno_Dias_Trans.Delete())
       {
          return Json(new { cssMainClass = "success", title = Messages.GetOrSetMensaje("MENSAJE_OPERACION_REALIZDA_SASTIFACTORIAMENTE_HEADER"), body = Messages.GetOrSetMensaje("MENSAJE_NOTIFICACION_REGISTRO_BORRADO") }, JsonRequestBehavior.AllowGet);
       }
       else
       {
          return Json(new { cssMainClass = "warning", title = Messages.GetOrSetMensaje("MENSAJE_PRECAUSION_HEADER"), body = Messages.GetOrSetMensaje("MENSAJE_NOTIFICACION_REGISTRO_NO_BORRADO") }, JsonRequestBehavior.AllowGet);
       }

}

public virtual ActionResult ReportHorarioTurnoDiasTrans(int dia_Secuencia){
    var horario_Turno_Dias_Trans = Dias_CataModel.LoadByEntityKey(dia_Secuencia.ToString());            
    return new CsvReportResult("Horario_Turno_Dias_Trans", horario_Turno_Dias_Trans.HorarioTurnoDiasTrans);
}

		 
 
		#endregion 
 
		#region Details 
 

		 
 
		#endregion 

	} 
} 


